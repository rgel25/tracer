<%- layout('layout/dashboard') %>

  <div class="container col-lg-10 mt-3 p-3">
    <div class="card shadow">
      <div class="card-body">
        <div class="row">
          <div class="col-lg-4">
            <h4 class="card-title fw-bold p-2">Project List </h4>
          </div>
          <div class='col-lg-2 offset-lg-6'>
            <a href="/dashboard/projects/new" class="btn btn-theme-dark btn-with-logo my-2 my-md-0">
              <i class="bi bi-plus-lg pe-1"></i>
                New Project 
            </a>
          </div>
        </div>
        <div class="table-responsive">
          <table class='table table-hover align-middle'>
            <thead class='align-middle'>
                <tr>
                    <th>Name</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Priority</th>
                    <th class='col-1 text-center'>Ticket Count</th>
                    <th class='col-2 text-center'>Details</th>
                </tr>
            </thead>
            <tbody >
                <% projects.forEach(proj => { %>
                  <tr>
                    <td><a href="/dashboard/projects/<%= proj.id %>/view" class="text-decoration-none text-dark"><%= proj.project_name %></a></td>
                    <td><%= proj.project_start %> </td>
                    <td><%= proj.project_end %> </td>
                    <td><%= proj.projectPriority.name %> </td>
                    <td class='text-center'><%= proj.tickets.length %></td>
                    <td class='text-center'>    
                      <a href="/dashboard/projects/<%= proj.id %>/view"><i class="bi bi-eye-fill text-primary fs-4 pe-1"></i></a>
                      <a href="/dashboard/projects/<%= proj.id %>/update"><i class="bi bi-pencil-square text-warning fs-4 pe-1"></i></a>
                      <a data-bs-toggle="modal" data-bs-target="#archiveModalProjectID<%=proj.id%>"><i class="bi bi-trash3-fill text-danger fs-4 pe-1" id="deleteButton"></i></a>
                  </td>
                  </tr>

                  <!-- modal -->
                  <div
                    class="modal fade"
                    id="archiveModalProjectID<%=proj.id%>"
                    tabindex="-1"
                    aria-labelledby="exampleModalLabel"
                    aria-hidden="true"
                  >
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">
                          Confirm Delete
                        </h5>
                        <button
                          type="button"
                          class="btn-close"
                          data-bs-dismiss="modal"
                          aria-label="Close"
                        ></button>
                      </div>
                      <div class="modal-body">
                        Are you sure you want to delete this project?
                      </div>
                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-bs-dismiss="modal"
                        >
                          Close
                        </button>
                        <form
                          class="d-inline"
                          action="/dashboard/projects/<%=proj.id%>/archive?_method=PUT"
                          method="POST"
                        >
                          <button type="submit" class="btn btn-danger">Delete</button>
                        </form>
                <% }) %>   
            </tbody>
          </table>      
        </div>
        <div class="row p-3">
            <ul class="pagination">
              <% if(projects.length > 1) { %> 
              <% if(currentPage === 1) { %> 
              <li class="page-item disabled">
                <a class="page-link" href="#" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
              <% } else { %> 
                <li class="page-item">
                  <a class="page-link" href="/dashboard/projects?page=<%= currentPage - 1 %>" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                  </a>
                </li>
              <% } %> 
              
              
              <% var i = (Number(currentPage) > 5 ? Number(currentPage) - 4 : 1) %>
              <% if (i !== 1) { %>
                  <li class="disabled"><a>...</a></li>
              <% } %>
              <% for (; i <= (Number(currentPage) + 4) && i <= totalPages; i++) { %>
                  <% if (i == currentPage) { %>
                    <li class="page-item active" ><a class="page-link" href="/dashboard/projects?page=<%= i %>"><%= currentPage %> </a></li>
                  <% } else { %>
                    <li class="page-item" ><a class="page-link" href="/dashboard/projects?page=<%= i %>"><%= i %> </a></li>
                  <% } %>
                  <% if (i == Number(currentPage) + 4 && i < totalPages) { %>
                    <li class="page-item" ><a class="page-link" href="#">...</a></li>
                  <% } %>
              <% } %>
              <% if (currentPage == totalPages) { %>
                <li class="page-item disabled">
                  <a class="page-link" href="#" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                  </a>
                </li>
              <% } else { %>
                <li class="page-item">
                  <a class="page-link" href="/dashboard/projects?page=<%= currentPage + 1 %>" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                  </a>
                </li>
              <% } %>
              <% } else { %>
                <li class="row offset-3 text-center">
                  <h2>No Project Found</h2> 
                  <span><a href="/dashboard/projects?page=1" class="text-decoration-none btn btn-theme-dark mt-3">Go Back</a></span>
                </li>
              <% } %> 

            </ul>
        </div>
      </div>
    </div>
    


</div>